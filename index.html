<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Stack: OSH Edition</title>
    <style>
        :root {
            --bg-color: #2b2b2b;
            --p1-bg: #e3f2fd; /* Blau */
            --p2-bg: #fce4ec; /* Rosa */
            --repo-bg: #37474f;
            --card-w: 85px;
            --card-h: 120px;
            --accent: #ff9800;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; background: var(--bg-color); 
            margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; user-select: none; 
        }

        /* --- HEADER & BRANDING --- */
        #top-bar {
            background: white; padding: 5px 20px; display: flex; justify-content: space-between; align-items: center;
            height: 50px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); z-index: 10;
        }
        #logo-img { height: 40px; width: auto; }
        .nav-link { text-decoration: none; color: #333; font-weight: bold; font-size: 0.9rem; }
        .nav-link:hover { color: var(--accent); }

        /* --- GAME BOARD --- */
        #game-board { flex: 1; display: flex; overflow: hidden; }
        
        .player-panel { flex: 1; padding: 10px; display: flex; flex-direction: column; gap: 5px; position: relative; transition: opacity 0.3s; }
        #p1-panel { background: var(--p1-bg); border-right: 4px solid #555; }
        #p2-panel { background: var(--p2-bg); border-left: 4px solid #555; }
        
        #repo-panel {
            flex: 0.5; background: var(--repo-bg); display: flex; flex-direction: column; 
            align-items: center; padding: 10px 5px; color: white; box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }

        /* --- HUD & REZEPTE --- */
        .header-box { background: rgba(255,255,255,0.95); padding: 8px 12px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .player-name { font-weight: bold; font-size: 1rem; margin: 0; }
        .cash { color: #2e7d32; font-weight: bold; font-size: 1.1rem; background: #e8f5e9; padding: 2px 8px; border-radius: 10px; }
        
        .target-title { font-size: 0.85rem; color: #d32f2f; font-weight: bold; margin-bottom: 3px; }
        
        /* Das visuelle Rezept */
        .recipe-list { display: flex; gap: 8px; }
        .recipe-item { 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: 40px; height: 50px; background: #eee; border-radius: 4px; border: 1px dashed #999;
            opacity: 0.5; transition: all 0.3s;
        }
        .recipe-item.done { 
            background: #c8e6c9; border: 2px solid #4caf50; opacity: 1; transform: scale(1.1); box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .recipe-icon { font-size: 1.2rem; }
        .recipe-name { font-size: 0.5rem; text-align: center; overflow: hidden; white-space: nowrap; width: 100%; }

        /* --- AREAS --- */
        .label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: #666; margin-top: 10px; font-weight: bold; }
        .card-container { display: flex; flex-wrap: wrap; gap: 5px; align-content: flex-start; min-height: 125px; padding: 5px; border-radius: 6px; background: rgba(0,0,0,0.05); }
        #repo-list { flex: 1; width: 100%; overflow-y: auto; justify-content: center; }

        /* --- CARDS --- */
        .card {
            width: var(--card-w); height: var(--card-h);
            background: white; border-radius: 6px; border: 1px solid #999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 2px; position: relative;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3); cursor: pointer; transition: transform 0.1s;
        }
        .card:hover { transform: scale(1.05); z-index: 100; }
        .card.generic { background: #fff9c4; }
        .card.unique { background: #e1bee7; }
        .card.joker { background: #e0f7fa; border: 2px solid #006064; }
        .card.grant { background: #c8e6c9; border: 2px dashed #4caf50; }

        .emoji { font-size: 2rem; margin-bottom: 5px; }
        .name { font-size: 0.75rem; font-weight: bold; line-height: 1.1; margin-bottom: 2px; }
        .type { font-size: 0.6rem; color: #555; }
        .cost-badge {
            position: absolute; top: -5px; right: -5px; background: #333; color: white;
            border-radius: 50%; width: 20px; height: 20px; font-size: 0.7rem; font-weight: bold;
            display: flex; align-items: center; justify-content: center; z-index: 2;
        }

        /* --- ACTIONS --- */
        .actions {
            position: absolute; inset: 0; background: rgba(255,255,255,0.96);
            display: none; flex-direction: column; justify-content: center; align-items: center; gap: 4px; border-radius: 6px;
        }
        .card:hover .actions { display: flex; }
        
        button { border: none; padding: 5px; border-radius: 4px; font-size: 0.65rem; color: white; cursor: pointer; width: 90%; font-weight: bold; box-shadow: 0 2px 2px rgba(0,0,0,0.2); }
        .btn-build { background: #4caf50; }
        .btn-share { background: #2196f3; }
        .btn-repo { background: #ff9800; }
        .btn-fork { background: #d32f2f; }
        .btn-select { background: #673ab7; margin-top: 5px; padding: 8px; font-size: 0.8rem; }

        /* --- DECK --- */
        .deck {
            width: var(--card-w); height: var(--card-h);
            background: repeating-linear-gradient(45deg, #455a64, #455a64 10px, #37474f 10px, #37474f 20px);
            border: 2px solid white; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            color: white; cursor: pointer; text-align: center; margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: all 0.2s;
        }
        .deck:hover { box-shadow: 0 0 15px #64ffda; transform: translateY(-2px); }

        /* --- FOOTER / FACTS --- */
        #fact-ticker {
            height: 40px; background: #222; color: #eee; display: flex; align-items: center; justify-content: center;
            font-size: 0.9rem; border-top: 1px solid #444; padding: 0 20px; text-align: center;
        }
        .highlight-fact { color: var(--accent); font-weight: bold; margin-right: 5px; }

        /* --- MODAL --- */
        #research-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 200;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        #research-cards { display: flex; gap: 20px; margin-top: 20px; }
        #research-title { color: white; font-size: 1.5rem; text-align: center; }

        /* STATES */
        .inactive { opacity: 0.4; pointer-events: none; filter: grayscale(1); }
        .turn-active { border: 2px solid var(--accent); box-shadow: 0 0 15px rgba(255,152,0,0.3); }

/* --- FIX F√úR FORSCHUNGS-MODAL --- */
#research-cards .card {
    /* Karte etwas gr√∂√üer machen im Modal, damit der Button passt */
    height: 140px; 
    justify-content: space-between;
    padding-bottom: 8px;
}

#research-cards .actions {
    /* WICHTIG: Overlay entfernen */
    position: static; 
    background: transparent;
    display: flex !important; /* Immer anzeigen */
    height: auto;
    margin-top: 5px;
}

#research-cards .btn-select {
    background: #673ab7;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}

    </style>
</head>
<body>

<div id="top-bar">
    <img id="logo-img" src="https://www.oshop-network.de/wp-content/uploads/go-x/u/5fec85f5-97d2-4d79-b8b5-888f5e79a17e/image-640x369.png" alt="OSHOP Logo">
    <a href="https://www.oshop-network.de/" target="_blank" class="nav-link">üåê oshop-network.de</a>
</div>

<div id="research-modal">
    <div id="research-title">
        üî¨ Forschungsergebnisse<br>
        <span style="font-size:1rem; font-weight:normal; color:#ccc;">W√§hle 1 Karte f√ºr deine Hand. Der Rest wird Open Source.</span>
    </div>
    <div id="research-cards"></div>
</div>

<div id="game-board">
    <div id="p1-panel" class="player-panel">
        <div class="header-box">
            <div class="header-row">
                <h2 class="player-name">Spieler 1</h2>
                <div class="cash"><span id="p1-cash">0</span> $</div>
            </div>
            <div class="target-title">Ziel: <span id="p1-target-name">...</span></div>
            <div class="recipe-list" id="p1-recipe"></div>
        </div>

        <div class="label">Deine Handkarten</div>
        <div id="p1-hand" class="card-container"></div>
        <div class="label">Werkbank (Gebaut)</div>
        <div id="p1-bench" class="card-container" style="background:rgba(0,0,0,0.08);"></div>
    </div>

    <div id="repo-panel">
        <div class="deck" onclick="startResearch()">
            <div style="font-size:1.8rem">üî¨</div>
            <div style="font-weight:bold;">Forschen</div>
            <div style="font-size:0.6rem; color:#81d4fa;">(Ziehe 3, W√§hle 1)</div>
            <div style="background:#000; padding:2px 8px; border-radius:10px; font-size:0.7rem; margin-top:5px;">2 $</div>
            <div id="deck-count" style="font-size:0.6rem; margin-top:5px; opacity:0.7;">0 Karten</div>
        </div>

        <div style="font-weight:bold; font-size:0.9rem; margin-bottom:5px;">üåê Repository</div>
        <div style="font-size:0.7rem; margin-bottom:10px; color:#aaa;">Teile nehmen kostet 1 $</div>
        <div id="repo-list" class="card-container" style="justify-content: center;"></div>
    </div>

    <div id="p2-panel" class="player-panel">
        <div class="header-box">
            <div class="header-row">
                <h2 class="player-name">Spieler 2</h2>
                <div class="cash"><span id="p2-cash">0</span> $</div>
            </div>
            <div class="target-title">Ziel: <span id="p2-target-name">...</span></div>
            <div class="recipe-list" id="p2-recipe"></div>
        </div>

        <div class="label">Deine Handkarten</div>
        <div id="p2-hand" class="card-container"></div>
        <div class="label">Werkbank (Gebaut)</div>
        <div id="p2-bench" class="card-container" style="background:rgba(0,0,0,0.08);"></div>
    </div>
</div>

<div id="fact-ticker">
    <span id="fact-text">Lade OSH Fakten...</span>
</div>

<script>
    // --- DATEN ---
    const projects = [
        { id: 'smarthome', name: 'Smart Home Hub', parts: ['MCU', 'PSU', 'Structure', 'Radio-Chip'], emoji: 'üè†' },
        { id: 'prusa', name: 'Prusa i3', parts: ['Motor', 'Display', 'PSU', 'Hotend'], emoji: 'üñ®Ô∏è' },
        { id: 'solar', name: 'Libre Solar', parts: ['MCU', 'Display', 'PSU', 'MOSFETs'], emoji: '‚òÄÔ∏è' },
        { id: 'farm', name: 'FarmBot', parts: ['MCU', 'Motor', 'Structure', 'Ventil'], emoji: 'ü•ï' },
        { id: 'prosthetic', name: 'Open Prosthetic', parts: ['Motor', 'Structure', 'PSU', 'Sensor'], emoji: 'ü¶æ' }
    ];

    const generics = ['MCU', 'Display', 'PSU', 'Motor', 'Structure'];
    
    // Emoji Map f√ºr alle Teile
    const emojiMap = {
        'MCU': 'üìü', 'Display': 'üñ•Ô∏è', 'PSU': 'üîã', 'Motor': '‚öôÔ∏è', 'Structure': 'üèóÔ∏è',
        'Radio-Chip': 'üì°', 'Hotend': 'üî•', 'MOSFETs': '‚ö°', 'Ventil': 'üö∞', 'Sensor': 'üß¨'
    };

    const facts = [
        "OSH = Open Source Hardware. Das Design ist f√ºr alle √∂ffentlich.",
        "Die 4 Freiheiten: Nutzen, Studieren, √Ñndern, Verbreiten.",
        "Die OSHWA zertifiziert echte Open Source Hardware.",
        "Transparenz bedeutet: Schaltpl√§ne + St√ºckliste (BOM) m√ºssen offen sein.",
        "Kein Vendor Lock-in: Du kannst Ersatzteile selbst bauen.",
        "CERN OHL ist eine spezielle Lizenz f√ºr offene Hardware.",
        "Copyleft Lizenzen verlangen, dass √Ñnderungen auch offen bleiben.",
        "Creative Commons (CC) wird oft f√ºr Dokumentation genutzt.",
        "OSH f√∂rdert das 'Right to Repair' massiv.",
        "Lokale Produktion spart CO2 und Transportwege.",
        "In der Pandemie halfen OSH-Designs bei Beatmungsger√§ten.",
        "Arduino ist das wohl ber√ºhmteste OSH-Projekt.",
        "RepRap Drucker k√∂nnen ihre eigenen Ersatzteile drucken.",
        "RISC-V ist eine offene Prozessor-Architektur.",
        "FarmBot baut automatisch Gem√ºse im Garten an.",
        "DIN SPEC 3105 ist ein Standard f√ºr OSH-Dokumentation.",
        "Forking hei√üt: Ein Design nehmen und verbessert ver√∂ffentlichen.",
        "Community-Reviews finden Fehler schneller als geschlossene Teams.",
        "GOSH setzt sich f√ºr offene Hardware in der Wissenschaft ein.",
        "OSH erm√∂glicht Bildung durch 'Anfassen und Verstehen'.",
        "TAPR OHL war eine Pionier-Lizenz f√ºr Hardware.",
        "Offene Designs erleichtern Recycling und Kreislaufwirtschaft.",
        "Makerspaces sind die Geburtsst√§tten vieler OSH-Ideen.",
        "Bill of Materials (BOM) muss Bezugsquellen enthalten.",
        "Demokratisierung: High-Tech f√ºr alle zug√§nglich machen.",
        "Libre Solar baut offene Laderegler f√ºr Solaranlagen.",
        "SatNOGS ist ein Netzwerk offener Satelliten-Bodenstationen.",
        "Permissive Lizenzen erlauben auch kommerzielle, geschlossene Nutzung.",
        "Pine64 baut Laptops auf OSH-Basis.",
        "Offene Hardware st√§rkt die technologische Souver√§nit√§t."
    ];

    const COST = { RESEARCH: 2, REPO: 1, FORK: 3, UNI_KOOP: 2 };
    const REWARD = { SHARE: 3, BUILD: 1, GRANT: 6 };

    let state = {
        deck: [],
        repo: [],
        turn: 1,
        tempResearch: [],
        players: {
            1: { hand: [], bench: [], cash: 5, target: null },
            2: { hand: [], bench: [], cash: 5, target: null }
        }
    };

    // --- SETUP ---
    function init() {
        let cards = [];
        let id = 0;

        // 1. Generics (5x pro Typ)
        generics.forEach(g => {
            for(let i=0; i<5; i++) cards.push({ id: id++, name: g, type: 'generic', emoji: emojiMap[g] });
        });

        // 2. Uniques (3x pro Typ)
        projects.forEach(p => {
            let unique = p.parts.find(part => !generics.includes(part));
            for(let i=0; i<3; i++) cards.push({ id: id++, name: unique, type: 'unique', emoji: emojiMap[unique] || '‚≠ê' });
        });

        // 3. Joker "Uni-Koop" (3x)
        for(let i=0; i<3; i++) cards.push({ id: id++, name: 'Uni-Koop', type: 'joker', emoji: 'üèõÔ∏è' });
        
        // 4. Grants (5x)
        for(let i=0; i<5; i++) cards.push({ id: id++, name: 'F√∂rderung', type: 'grant', emoji: 'üí∏' });

        state.deck = cards.sort(() => Math.random() - 0.5);

        // Ziele zuweisen
        let pIdx = [0, 1, 2, 3, 4].sort(() => Math.random() - 0.5);
        state.players[1].target = projects[pIdx[0]];
        state.players[2].target = projects[pIdx[1]];

        // Starthand
        for(let i=0; i<3; i++) {
            state.players[1].hand.push(state.deck.pop());
            state.players[2].hand.push(state.deck.pop());
        }

        startTicker();
        render();
        updateTurnUI();
    }

    // --- LOGIK: RESEARCH ---
    function startResearch() {
        let p = state.players[state.turn];
        if(p.cash < COST.RESEARCH) return alert(`Forschung kostet ${COST.RESEARCH}$`);
        if(state.deck.length === 0) return alert("Keine Karten mehr im Stapel!");

        p.cash -= COST.RESEARCH;
        
        state.tempResearch = [];
        let count = Math.min(3, state.deck.length);
        for(let i=0; i<count; i++) state.tempResearch.push(state.deck.pop());

        showResearchModal();
        render(); 
    }

    function showResearchModal() {
        const modal = document.getElementById('research-modal');
        const container = document.getElementById('research-cards');
        container.innerHTML = '';

        state.tempResearch.forEach((card, index) => {
            let el = document.createElement('div');
            // Karte rendern
            el.innerHTML = renderCardHTML(card, 'modal', 0);
            
            // Den generierten HTML-String in ein echtes Element umwandeln
            // damit wir den Button manipulieren k√∂nnen
            let cardDiv = el.firstElementChild;
            
            // Button austauschen
            let btnDiv = cardDiv.querySelector('.actions');
            btnDiv.innerHTML = `<button class="btn-select" onclick="finishResearch(${index})">‚úÖ Nehmen</button>`;
            
            // HIER WAR DER FEHLER: Wir d√ºrfen .style.display nicht manuell setzen, 
            // das CSS erledigt das jetzt sauber √ºber #research-cards .actions
            
            container.appendChild(cardDiv);
        });

        modal.style.display = 'flex';
    }

    function finishResearch(idx) {
        let p = state.players[state.turn];
        p.hand.push(state.tempResearch[idx]);

        // Rest ins Repo
        state.tempResearch.forEach((card, i) => {
            if(i !== idx) state.repo.push(card);
        });

        state.tempResearch = [];
        document.getElementById('research-modal').style.display = 'none';
        switchTurn();
    }

    // --- LOGIK: AKTIONEN ---
    function build(cardId) {
        let p = state.players[state.turn];
        let cIdx = p.hand.findIndex(c => c.id === cardId);
        let card = p.hand[cIdx];
        let cost = 0;

        if(card.type === 'joker') { // Uni-Koop
            let currentParts = p.bench.map(c => c.realName || c.name);
            let neededParts = p.target.parts;
            // Finde erstes fehlendes generisches Teil
            let missingGeneric = neededParts.find(part => generics.includes(part) && !currentParts.includes(part));

            if(!missingGeneric) return alert("Uni-Koop kann nur fehlende Standard-Teile ersetzen (keine Unikate)!");
            if(p.cash < COST.UNI_KOOP) return alert(`Uni-Koop kostet ${COST.UNI_KOOP}$ Overhead!`);
            
            cost = COST.UNI_KOOP;
            card.realName = missingGeneric; 
            card.displayName = `Uni: ${missingGeneric}`;
            card.emoji = emojiMap[missingGeneric]; // Icon anpassen
        } 
        else if (card.type === 'grant') {
            return alert("F√∂rderung kann man nicht bauen! Nutze 'Teilen' f√ºr Geld.");
        }
        else {
            if(!p.target.parts.includes(card.name)) return alert("Teil passt nicht zum Projekt!");
            let existing = p.bench.find(c => (c.realName || c.name) === card.name);
            if(existing) return alert("Teil bereits verbaut!");
        }

        p.cash -= cost;
        p.cash += REWARD.BUILD;
        p.hand.splice(cIdx, 1);
        p.bench.push(card);
        
        checkWin(state.turn);
        switchTurn();
    }

    function share(cardId) {
        let p = state.players[state.turn];
        let cIdx = p.hand.findIndex(c => c.id === cardId);
        let card = p.hand[cIdx];

        p.hand.splice(cIdx, 1);
        state.repo.push(card);
        
        let reward = (card.type === 'grant') ? REWARD.GRANT : REWARD.SHARE;
        p.cash += reward;
        if(card.type === 'grant') alert(`F√ñRDERUNG BEWILLIGT! +${reward}$`);
        
        switchTurn();
    }

    function takeFromRepo(cardId) {
        let p = state.players[state.turn];
        if(p.cash < COST.REPO) return alert("Zu wenig Geld!");
        
        let cIdx = state.repo.findIndex(c => c.id === cardId);
        p.cash -= COST.REPO;
        p.hand.push(state.repo.splice(cIdx, 1)[0]);
        switchTurn();
    }

    function fork(targetPid, cardId) {
        let active = state.players[state.turn];
        let target = state.players[targetPid];
        if(active.cash < COST.FORK) return alert(`Fork kostet ${COST.FORK}$`);

        let cIdx = target.bench.findIndex(c => c.id === cardId);
        let card = target.bench[cIdx];
        let partName = card.realName || card.name;

        if(!active.target.parts.includes(partName)) return alert("Brauchst du nicht!");
        if(active.bench.find(c => (c.realName || c.name) === partName)) return alert("Hast du schon!");

        active.cash -= COST.FORK;
        target.bench.splice(cIdx, 1);
        active.bench.push(card);
        
        checkWin(state.turn);
        switchTurn();
    }

    function checkWin(pid) {
        let p = state.players[pid];
        let have = p.bench.map(c => c.realName || c.name);
        let complete = p.target.parts.every(part => have.includes(part));
        
        if(complete) {
            setTimeout(() => {
                alert(`üéâ GL√úCKWUNSCH SPIELER ${pid}!\nProjekt "${p.target.name}" wurde erfolgreich ver√∂ffentlicht!`);
                location.reload();
            }, 200);
        }
    }

    function switchTurn() {
        state.turn = state.turn === 1 ? 2 : 1;
        render();
        updateTurnUI();
    }

    // --- RENDER & UI ---

    function renderCardHTML(card, loc, owner) {
        let btns = '';
        let isMyTurn = (state.turn === owner);
        
        if(loc === 'hand' && isMyTurn) {
            if(card.type !== 'grant') btns += `<button class="btn-build" onclick="build(${card.id})">üõ†Ô∏è Bauen</button>`;
            btns += `<button class="btn-share" onclick="share(${card.id})">üåê Teilen (+$$)</button>`;
        }
        else if(loc === 'repo') {
            btns += `<button class="btn-repo" onclick="takeFromRepo(${card.id})">‚úã Nehmen (1$)</button>`;
        }
        else if(loc === 'bench' && state.turn !== owner && owner !== 0) {
            // Nur Forkbar wenn ich es brauche und noch nicht habe
            let active = state.players[state.turn];
            let pName = card.realName || card.name;
            if(active.target.parts.includes(pName) && !active.bench.find(c=>(c.realName||c.name)===pName)) {
                btns += `<button class="btn-fork" onclick="fork(${owner}, ${card.id})">‚ö° FORK (3$)</button>`;
            }
        }

        let displayName = card.displayName || card.name;
        let displayClass = card.type;
        if(card.realName) displayClass += " generic"; // Uni-Koop sieht nach Bau aus wie Generic

        // Badge f√ºr Uni Koop Kosten
        let badge = (card.type === 'joker' && loc === 'hand') ? `<div class="cost-badge">2$</div>` : '';

        return `
            <div class="card ${displayClass}">
                ${badge}
                <div class="emoji">${card.emoji}</div>
                <div class="name">${displayName}</div>
                <div class="type">${card.type}</div>
                <div class="actions">${btns}</div>
            </div>
        `;
    }

    function renderRecipe(playerId) {
        const p = state.players[playerId];
        const container = document.getElementById(`p${playerId}-recipe`);
        container.innerHTML = '';

        // Welche Teile habe ich schon?
        const builtParts = p.bench.map(c => c.realName || c.name);

        p.target.parts.forEach(partName => {
            const isBuilt = builtParts.includes(partName);
            const div = document.createElement('div');
            div.className = `recipe-item ${isBuilt ? 'done' : ''}`;
            div.innerHTML = `
                <div class="recipe-icon">${isBuilt ? '‚úÖ' : (emojiMap[partName] || '‚ùì')}</div>
                <div class="recipe-name">${partName}</div>
            `;
            container.appendChild(div);
        });
    }

    function render() {
        // Stats und Texte
        document.getElementById('p1-target-name').innerText = state.players[1].target.name;
        document.getElementById('p2-target-name').innerText = state.players[2].target.name;
        document.getElementById('p1-cash').innerText = state.players[1].cash;
        document.getElementById('p2-cash').innerText = state.players[2].cash;
        document.getElementById('deck-count').innerText = state.deck.length + " Karten";

        // Bereiche leeren
        ['p1-hand', 'p1-bench', 'p2-hand', 'p2-bench', 'repo-list'].forEach(id => {
            document.getElementById(id).innerHTML = '';
        });

        // Karten rendern
        state.players[1].hand.forEach(c => document.getElementById('p1-hand').innerHTML += renderCardHTML(c, 'hand', 1));
        state.players[1].bench.forEach(c => document.getElementById('p1-bench').innerHTML += renderCardHTML(c, 'bench', 1));
        
        state.players[2].hand.forEach(c => document.getElementById('p2-hand').innerHTML += renderCardHTML(c, 'hand', 2));
        state.players[2].bench.forEach(c => document.getElementById('p2-bench').innerHTML += renderCardHTML(c, 'bench', 2));
        
        state.repo.forEach(c => document.getElementById('repo-list').innerHTML += renderCardHTML(c, 'repo', 0));

        // Rezepte aktualisieren
        renderRecipe(1);
        renderRecipe(2);
    }

    function updateTurnUI() {
        let t = state.turn;
        document.getElementById('p1-panel').style.opacity = (t===1) ? '1' : '0.6';
        document.getElementById('p2-panel').style.opacity = (t===2) ? '1' : '0.6';
        
        document.getElementById('p1-panel').classList.toggle('turn-active', t===1);
        document.getElementById('p2-panel').classList.toggle('turn-active', t===2);

        document.getElementById('p1-panel').style.pointerEvents = (t===1) ? 'auto' : 'none';
        document.getElementById('p2-panel').style.pointerEvents = (t===2) ? 'auto' : 'none';
    }

    // --- TICKER ---
    function startTicker() {
        const el = document.getElementById('fact-text');
        let idx = 0;
        setInterval(() => {
            el.style.opacity = 0;
            setTimeout(() => {
                el.innerHTML = `<span class="highlight-fact">WISSEN:</span> ${facts[idx]}`;
                el.style.opacity = 1;
                idx = (idx + 1) % facts.length;
            }, 500);
        }, 8000); // Alle 8 Sekunden neuer Fakt
        
        // Initialer Text
        el.innerHTML = `<span class="highlight-fact">WISSEN:</span> ${facts[0]}`;
    }

    // Start
    init();

</script>
</body>
</html>
